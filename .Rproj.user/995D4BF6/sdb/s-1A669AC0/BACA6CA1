{
    "collab_server" : "",
    "contents" : "################################################################################\n### Set constants and define functions\n################################################################################\n\n############### Constants #####################################################\n\nelo_diff <- 400\nk <- 32\n\n# Players below 2100: K-factor of 32 used\n# Players between 2100 and 2400: K-factor of 24 used\n# Players above 2400: K-factor of 16 used.\n\n############### Functions #####################################################\n\nmake_names <-\n  # Function to clean up column names\n  . %>%\n  str_trim %>%\n  make.names %>%\n  str_replace_all('[.]', '_') %>%\n  tolower %>%\n  str_replace_all('__{1,4}', '_') %>%\n  str_replace_all('_$', '')\n\n\nFormatName <- function(name){\n  paste0(toupper(substr(name, 1, 1)), substr(name, 2, nchar(name)))\n}\n\nCalculateChance <- function(p1_elo, p2_elo){\n  Q1 <- 10^(p1_elo/elo_diff)\n  Q2 <- 10^(p2_elo/elo_diff)\n  expected_p1 <- Q1/(Q1+Q2)\n  return(expected_p1)\n}\n\nGameUpdate <- function(data, player1, score1, player2, score2,\n                       print_progress = FALSE) {\n\n  player1 %<>% FormatName\n  player2 %<>% FormatName\n  score1  %<>% as.numeric\n  score2  %<>% as.numeric\n\n  elo1 <- data[grepl(player1, data$players), \"elo\"] %>% as.numeric\n  elo2 <- data[grepl(player2, data$players), \"elo\"] %>% as.numeric\n\n  expected1 <- CalculateChance(elo1, elo2)\n  expected2 <- 1 - expected1\n\n  point_diff <- score1 - score2\n\n  margin_of_victory <- log(abs(point_diff))*(2.2/((\n    ifelse(score1 > score2, elo1-elo2, elo2-elo1))*.001+2.2))\n\n  k_adj <- k * margin_of_victory\n\n  p1_res <- ifelse(score1 > score2, 1, 0)\n  p2_res <- ifelse(score1 > score2, 0, 1)\n\n  updated_elo1 <- elo1 + k_adj*(p1_res - expected1)\n  updated_elo2 <- elo2 + k_adj*(p2_res - expected2)\n\n  ## optional progress printing\n  if(print_progress){\n    cat(player1, \"P1:\", elo1, \"->\", updated_elo1, \"\\t|\",\n        player2, \"P2:\", elo2, \"->\", updated_elo2, \"\\n\")\n  }\n\n  ## update elo\n  data[grepl(player1, data$players), \"elo\"] <- updated_elo1\n  data[grepl(player2, data$players), \"elo\"] <- updated_elo2\n\n  ## increment games\n  data[grepl(player1, data$players), \"number_of_games\"] <-\n    data[grepl(player1, data$players), \"number_of_games\"] + 1\n  data[grepl(player2, data$players), \"number_of_games\"] <-\n    data[grepl(player2, data$players), \"number_of_games\"] + 1\n\n\n  return(data)\n}",
    "created" : 1477689077842.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "811344937",
    "id" : "BACA6CA1",
    "lastKnownWriteTime" : 1478047840,
    "last_content_update" : 1478047840516,
    "path" : "C:/Users/kevin pan/Dropbox/dev/foos/foos_functions.R",
    "project_path" : "foos_functions.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}